
 <!DOCTYPE HTML>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  
    <title>Activity 共享元素转场动画实践 | Joe is a thin man</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Joe">
    

    
    <meta name="description" content="文章来源：itsCoder 的 WeeklyBolg 项目
itsCoder主页：http://itscoder.com/
作者：Joe
审阅者：Brucezz

前言上次碰到个需求，要从 Feed 页以 item 放大的动画打开第二个页面，先来看一个效果：

就是这样一个转场动画～有了思路后要实现起来还是不难
思路1.API一般我在需要实现某个功能的时候，会首先寻找 Android 是否已经提">
<meta property="og:type" content="article">
<meta property="og:title" content="Activity 共享元素转场动画实践">
<meta property="og:url" content="https://joesteven.github.io/zoom-up-animation/index.html">
<meta property="og:site_name" content="Joe is a thin man">
<meta property="og:description" content="文章来源：itsCoder 的 WeeklyBolg 项目
itsCoder主页：http://itscoder.com/
作者：Joe
审阅者：Brucezz

前言上次碰到个需求，要从 Feed 页以 item 放大的动画打开第二个页面，先来看一个效果：

就是这样一个转场动画～有了思路后要实现起来还是不难
思路1.API一般我在需要实现某个功能的时候，会首先寻找 Android 是否已经提">
<meta property="og:image" content="http://7xtakx.com1.z0.glb.clouddn.com/zoom_up.gif">
<meta property="og:updated_time" content="2016-12-12T14:42:15.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Activity 共享元素转场动画实践">
<meta name="twitter:description" content="文章来源：itsCoder 的 WeeklyBolg 项目
itsCoder主页：http://itscoder.com/
作者：Joe
审阅者：Brucezz

前言上次碰到个需求，要从 Feed 页以 item 放大的动画打开第二个页面，先来看一个效果：

就是这样一个转场动画～有了思路后要实现起来还是不难
思路1.API一般我在需要实现某个功能的时候，会首先寻找 Android 是否已经提">
<meta name="twitter:image" content="http://7xtakx.com1.z0.glb.clouddn.com/zoom_up.gif">

    
    <link rel="alternative" href="atom.xml" title="Joe is a thin man" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/avatar.png">
    
    
    <link rel="apple-touch-icon" href="/img/profile.png">
    <link rel="apple-touch-icon-precomposed" href="/img/profile.png">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Joe is a thin man">Joe is a thin man</a></h1>
				<h2 class="blog-motto">写代码的民谣歌手</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/categories">Categories</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:joesteven.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/zoom-up-animation/" title="Activity 共享元素转场动画实践" itemprop="url">Activity 共享元素转场动画实践</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Joe" target="_blank" itemprop="author">Joe</a>
		
  <p class="article-time">
    <time datetime="2016-12-12T14:40:27.000Z" itemprop="datePublished"> 发表于 2016-12-12</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#思路"><span class="toc-number">2.</span> <span class="toc-text">思路</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-API"><span class="toc-number">2.1.</span> <span class="toc-text">1.API</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-实现思路"><span class="toc-number">2.2.</span> <span class="toc-text">2.实现思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#封装动画工具类"><span class="toc-number">3.</span> <span class="toc-text">封装动画工具类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-获取共享元素的初始信息"><span class="toc-number">3.1.</span> <span class="toc-text">1.获取共享元素的初始信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-封装动画执行接口"><span class="toc-number">3.2.</span> <span class="toc-text">2.封装动画执行接口</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现-Activity-转场动画"><span class="toc-number">4.</span> <span class="toc-text">实现 Activity 转场动画</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-进入动画"><span class="toc-number">4.1.</span> <span class="toc-text">1.进入动画</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-退出动画"><span class="toc-number">4.2.</span> <span class="toc-text">2.退出动画</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#坑"><span class="toc-number">5.</span> <span class="toc-text">坑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#相关资料"><span class="toc-number">6.</span> <span class="toc-text">相关资料</span></a></li></ol>
		
		</div>
		
		<ul>
<li>文章来源：itsCoder 的 <a href="https://github.com/itsCoder/weeklyblog" target="_blank" rel="external">WeeklyBolg</a> 项目</li>
<li>itsCoder主页：<a href="http://itscoder.com/" target="_blank" rel="external">http://itscoder.com/</a></li>
<li>作者：<a href="http://extremej.itscoder.com/" target="_blank" rel="external">Joe</a></li>
<li>审阅者：<a href="http://brucezz.itscoder.com/" target="_blank" rel="external">Brucezz</a></li>
</ul>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>上次碰到个需求，要从 Feed 页以 item 放大的动画打开第二个页面，先来看一个效果：</p>
<p><img src="http://7xtakx.com1.z0.glb.clouddn.com/zoom_up.gif" alt="效果图"></p>
<p>就是这样一个转场动画～有了思路后要实现起来还是不难</p>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><h4 id="1-API"><a href="#1-API" class="headerlink" title="1.API"></a>1.API</h4><p>一般我在需要实现某个功能的时候，会首先寻找 Android 是否已经提供了相关的 Api ，这样可以避免盲目的造轮子，尤其对于项目来说，时间成本还是很重要的，而且 Android 提供的 Api 使用起来一般也会更简单易于维护。</p>
<p>事实上在 Android 5.0 确实提供了这样的 Api — <code>ActivityOptions</code> 以及兼容包 <code>ActivityOptionsCompat</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ActivityOptionsCompat.makeCustomAnimation(Context context, <span class="keyword">int</span> enterResId, <span class="keyword">int</span> exitResId)</div><div class="line">ActivityOptionsCompat.makeScaleUpAnimation(View source,<span class="keyword">int</span> startX, <span class="keyword">int</span> startY, <span class="keyword">int</span> startWidth, <span class="keyword">int</span> startHeight)</div><div class="line">ActivityOptionsCompat.makeThumbnailScaleUpAnimation(View source,Bitmap thumbnail, <span class="keyword">int</span> startX, <span class="keyword">int</span> startY)</div><div class="line">ActivityOptionsCompat.makeSceneTransitionAnimation(Activity activity, View sharedElement, String sharedElementName)</div><div class="line">ActivityOptionsCompat.makeSceneTransitionAnimation(Activity activity,Pair&lt;View, String&gt;… sharedElements)</div></pre></td></tr></table></figure>
<p>这个类使用非常的简单，总共提供了五种方法来实现不同的动画效果，其中就包括我们需要的这种效果。所以一开始我是选择了用 Api 来实现，但是很快发现了有一些问题：</p>
<ul>
<li><p><code>makeScaleUpAnimation</code>可以实现我们需要的效果，但是在5.0及以下的手机上效果并不好，会闪屏。（看了下快手貌似是用这个方法实现的，测试发现有同样的问题）</p>
</li>
<li><p>后面两个效果较好的共享元素的方法在 5.0 以下的手机上无效果</p>
</li>
<li><p>虽然提供了兼容包，但是兼容包的作用仅仅是保证在低版本的系统上不会崩溃，但是不会有效果</p>
<p>由于我希望兼容到更低的版本上去，因此不得不放弃这个方案，如果你不需要兼容的话可以参考这篇文章来实现炫酷的转场动画<a href="https://www.kancloud.cn/qibin0506/android-md/117682" target="_blank" rel="external">你所不知道的Activity转场动画——ActivityOptions</a>。</p>
</li>
</ul>
<h4 id="2-实现思路"><a href="#2-实现思路" class="headerlink" title="2.实现思路"></a>2.实现思路</h4><p>通过使用 ActivityOptions 可以得出一个思路</p>
<ul>
<li>共享元素 — 两个 <code>Activity</code> 间有相同内容的 <code>View</code></li>
<li>TargetView — 第二个页面的 <code>View</code> 来执行动画</li>
<li>执行动画的过程中，第二个 <code>Activity</code> 背景透明</li>
</ul>
<p>明确了这三个关键点之后，实现起来就清晰很多，事实上这个思路不仅可以实现 <code>Activity</code> 间的动画跳转，一样可以适用于同一个 <code>Activity</code> 中的其它放大动画，例如点击头像出现大图，没有必要再开一个新的 <code>Activity</code>。</p>
<p>所以我们要做的是封装一个工具类，更加通用的执行动画。</p>
<h3 id="封装动画工具类"><a href="#封装动画工具类" class="headerlink" title="封装动画工具类"></a>封装动画工具类</h3><p>我们首先不去考虑 <code>Activity</code> 具体要怎么执行动画，先来封装一个动画的工具类。 </p>
<h4 id="1-获取共享元素的初始信息"><a href="#1-获取共享元素的初始信息" class="headerlink" title="1.获取共享元素的初始信息"></a>1.获取共享元素的初始信息</h4><p>我们封装一个工具类 — <code>ZoomAnimationUtils</code>，在这个类中定义一个 <code>ZoomInfo</code> model：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ZoomInfo</span> <span class="keyword">implements</span> <span class="title">Parcelable</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> screenX;</div><div class="line">    <span class="keyword">int</span> screenY;</div><div class="line">    <span class="keyword">int</span> width;</div><div class="line">    <span class="keyword">int</span> height;</div><div class="line">  ... 省略其它内容 ...</div><div class="line">｝</div></pre></td></tr></table></figure>
<p>这个类用于获取动画开始时 <code>View</code> 在屏幕上的位置，大小。实现序列化是为了在 <code>Activity</code> 之间能通过 <code>Intent</code> 传递。然后在 <code>ZoomAnimationUtils</code>  中封装一个获取 <code>ZoomInfo</code>  方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> ZoomAnimationUtils.<span class="function">ZoomInfo <span class="title">getZoomInfo</span><span class="params">(@NonNull View view)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span>[] screenLocation = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</div><div class="line">    view.getLocationOnScreen(screenLocation);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ZoomInfo(screenLocation[<span class="number">0</span>],</div><div class="line">                        screenLocation[<span class="number">1</span>],</div><div class="line">                        view.getWidth(),</div><div class="line">                        view.getHeight());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="2-封装动画执行接口"><a href="#2-封装动画执行接口" class="headerlink" title="2.封装动画执行接口"></a>2.封装动画执行接口</h4><p>在这个需求中我们至少需要提供两个方法，一个放大，一个缩小。先来写放大的动画，想一想我们需要哪些参数？</p>
<ul>
<li>第一个共享元素的信息 <code>ZoomInfo</code> (也就是效果图中列表里小图的信息)</li>
<li>第二个共享元素 <code>TargetView</code>  ，在这个 <code>View</code>  上来执行动画</li>
<li>Listener ，给调用者提供监听动画执行的回调 </li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startZoomUpAnim</span><span class="params">(<span class="keyword">final</span> ZoomInfo preViewInfo,</span></span></div><div class="line">                                   <span class="keyword">final</span> View targetView,</div><div class="line">                                   <span class="keyword">final</span> Animator.AnimatorListener listener) &#123;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>首先我们要将 <code>targetView</code> 的初始属性设置为 <code>preViewInfo</code> ，跟小图一样，因此要在 <code>onDraw</code> 之前就把这件事情先做完，系统提供了一个方法 <code>onPreDraw()</code> 很好的让我们来做这件事情，在上面的方法中添加下面的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">targetView.getViewTreeObserver().addOnPreDrawListener(<span class="keyword">new</span> ViewTreeObserver.OnPreDrawListener() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onPreDraw</span><span class="params">()</span> </span>&#123;</div><div class="line">      <span class="comment">// 务必记得 remove 掉 </span></div><div class="line">        targetView.getViewTreeObserver().removeOnPreDrawListener(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>开始计算开始的状态值，体力活～把逻辑先理清楚再计算，否则会掉入一直调试的怪圈中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> startWidth = preViewInfo.getWidth();</div><div class="line"><span class="keyword">int</span> startHeight = preViewInfo.getHeight();</div><div class="line"><span class="keyword">int</span> endWidth = targetView.getWidth();</div><div class="line"><span class="keyword">int</span> endHeight = targetView.getHeight();</div><div class="line"><span class="keyword">int</span>[] screenLocation = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</div><div class="line">targetView.getLocationOnScreen(screenLocation);</div><div class="line"><span class="keyword">int</span> endX = screenLocation[<span class="number">0</span>];</div><div class="line"><span class="keyword">int</span> endY = screenLocation[<span class="number">1</span>];</div><div class="line"><span class="keyword">float</span> startScaleX = (<span class="keyword">float</span>) endWidth / startWidth;</div><div class="line"><span class="keyword">float</span> startScaleY = (<span class="keyword">float</span>) endHeight / startHeight;</div><div class="line"><span class="keyword">int</span> translationX = preViewInfo.getScreenX() - endX;</div><div class="line"><span class="keyword">int</span> translationY = preViewInfo.getScreenY() - endY;</div><div class="line"></div><div class="line">targetView.setPivotX(<span class="number">0</span>);</div><div class="line">targetView.setPivotY(<span class="number">0</span>);</div><div class="line">targetView.setTranslationX(translationX);</div><div class="line">targetView.setTranslationY(translationY);</div><div class="line">targetView.setScaleX(<span class="number">1</span> / startScaleX);</div><div class="line">targetView.setScaleY(<span class="number">1</span> / startScaleY);</div></pre></td></tr></table></figure>
<p>上面这步做完后，就得到了一个在屏幕上与小图一样的一个 <code>View</code>  啦，现在来执行动画：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">targetView.setVisibility(View.VISIBLE);</div><div class="line">ViewPropertyAnimator animator = targetView.animate();</div><div class="line">animator.setDuration(ANIMATION_DURATION)</div><div class="line">        .scaleX(<span class="number">1f</span>)</div><div class="line">        .scaleY(<span class="number">1f</span>)</div><div class="line">        .translationX(<span class="number">0</span>)</div><div class="line">        .translationY(<span class="number">0</span>);</div><div class="line"><span class="keyword">if</span> (listener != <span class="keyword">null</span>) &#123;</div><div class="line">    animator.setListener(listener);</div><div class="line">&#125;</div><div class="line">animator.start();</div></pre></td></tr></table></figure>
<p>放大的动画就写完了～接下来我们写缩小的动画，思路与放大一样，但是有个小区别，我们缩小的动画实际也是大的那个 <code>View</code>  来执行，这个 <code>View</code> 当前的状态就是动画开始的初始状态，因此不需要做初始化：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startZoomDownAnim</span><span class="params">(ZoomInfo preViewInfo, <span class="keyword">final</span> View targetView, <span class="keyword">final</span> Animator.AnimatorListener listener)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> endWidth = preViewInfo.getWidth();</div><div class="line">    <span class="keyword">int</span> endHeight = preViewInfo.getHeight();</div><div class="line">    <span class="keyword">int</span> startWidth = targetView.getWidth();</div><div class="line">    <span class="keyword">int</span> startHeight = targetView.getHeight();</div><div class="line">    <span class="keyword">int</span> endX = preViewInfo.getScreenX();</div><div class="line">    <span class="keyword">int</span> endY = preViewInfo.getScreenY();</div><div class="line">    <span class="keyword">float</span> endScaleX = (<span class="keyword">float</span>) endWidth / startWidth;</div><div class="line">    <span class="keyword">float</span> endScaleY = (<span class="keyword">float</span>) endHeight / startHeight;</div><div class="line">    <span class="keyword">int</span>[] screenLocation = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</div><div class="line">    targetView.getLocationOnScreen(screenLocation);</div><div class="line">    <span class="keyword">int</span> startX = screenLocation[<span class="number">0</span>];</div><div class="line">    <span class="keyword">int</span> startY = screenLocation[<span class="number">1</span>];</div><div class="line">    <span class="keyword">int</span> translationX = endX - startX;</div><div class="line">    <span class="keyword">int</span> translationY = endY - startY;</div><div class="line"></div><div class="line">    targetView.setPivotX(<span class="number">0</span>);</div><div class="line">    targetView.setPivotY(<span class="number">0</span>);</div><div class="line">    targetView.setVisibility(View.VISIBLE);</div><div class="line">    ViewPropertyAnimator animator = targetView.animate();</div><div class="line">    animator.setDuration(ANIMATION_DURATION)</div><div class="line">            .scaleX(endScaleX)</div><div class="line">            .scaleY(endScaleY)</div><div class="line">            .translationX(translationX)</div><div class="line">            .translationY(translationY);</div><div class="line">    <span class="keyword">if</span> (listener != <span class="keyword">null</span>) &#123;</div><div class="line">        animator.setListener(listener);</div><div class="line">    &#125;</div><div class="line">  	animator.start();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="实现-Activity-转场动画"><a href="#实现-Activity-转场动画" class="headerlink" title="实现 Activity 转场动画"></a>实现 Activity 转场动画</h3><h4 id="1-进入动画"><a href="#1-进入动画" class="headerlink" title="1.进入动画"></a>1.进入动画</h4><p>上一步我们已经把动画封装好了，现在我们需要实现 <code>Activity</code>  的转场动画，还记得最开始的那个三个关键点中有一点，将 <code>Activity</code> 背景透明，注意这里的背景是指 <code>Window</code> 的背景，因此要在 style.xml 中定义一个透明主题：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"Translucent"</span> <span class="attr">parent</span>=<span class="string">"AppTheme"</span>&gt;</span><span class="xml"></span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"windowNoTitle"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowBackground"</span>&gt;</span>@android:color/transparent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:colorBackgroundCacheHint"</span>&gt;</span>@null<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowIsTranslucent"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowAnimationStyle"</span>&gt;</span>@null<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
<p><strong>着重说下<code>windowIsTranslucent</code> 必须为 true，否则即使设置了 background 为透明，也是黑色</strong></p>
<p>第二件事情要将 <code>Activity</code> 本身的转场动画去掉 <code>overridePendingTransition(0,0)</code>，这个方法要在调用 <code>startActivity</code> 后立即调用，我在 <code>DetailActivity</code>  中封装了一个静态方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startActivity</span><span class="params">(Activity from, View sharedView, FeedItem item)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span> (item == <span class="keyword">null</span>) <span class="keyword">return</span>;</div><div class="line">    Intent intent = <span class="keyword">new</span> Intent(from, DetailActivity.class);</div><div class="line">    intent.putExtra(EXTRA_FEED_ITEM, item);</div><div class="line">  <span class="comment">// 获取到前一个 view 的基本信息</span></div><div class="line">    intent.putExtra(EXTRA_ZOOM_INFO, ZoomAnimationUtils.getZoomInfo(sharedView));</div><div class="line">    from.startActivity(intent);</div><div class="line">  <span class="comment">// 去掉自带的转场动画</span></div><div class="line">    from.overridePendingTransition(<span class="number">0</span>,<span class="number">0</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里我们的共享 <code>View</code> 是一个 <code>ImageView</code> ，使用的图片加载框架是 <code>Picasso</code>，当然用什么框架都可以，但是要保证一点：<strong>动画开始执行时，这个共享元素的内容应该加载完成了</strong></p>
<p>我们在 <code>onCreate</code> 中先加载好图片</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">Picasso.with(<span class="keyword">this</span>)</div><div class="line">        .load(mFeedItem.getImageUrl())</div><div class="line">        .into(<span class="keyword">new</span> Target() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBitmapLoaded</span><span class="params">(Bitmap bitmap, Picasso.LoadedFrom from)</span> </span>&#123;</div><div class="line">              <span class="comment">// 加载图片</span></div><div class="line">                setBitmap(bitmap);</div><div class="line">              <span class="comment">// 执行进入的动画</span></div><div class="line">                tryEnterAnimation();</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBitmapFailed</span><span class="params">(Drawable errorDrawable)</span> </span>&#123;&#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPrepareLoad</span><span class="params">(Drawable placeHolderDrawable)</span> </span>&#123;&#125;</div><div class="line">        &#125;);</div></pre></td></tr></table></figure>
<p><code>tryEnterAniamtion()</code> 中的代码就简单了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">tryEnterAnimation</span><span class="params">()</span> </span>&#123;</div><div class="line">    ZoomAnimationUtils.startZoomUpAnim(mZoomInfo, mImageView, <span class="keyword">null</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>到这里，转场动画的进入部分就写完了，但是我们发现个问题～，那就是因为 <code>Activity</code> 是透明的，图片没有盖住的部分是能看到上一个 <code>Activity</code> 的，为了让动画效果更好，我们再加一个背景渐变的动画。</p>
<p>在 <code>ZoomAnimationUtils</code> 中添加一个方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startBackgroundAlphaAnim</span><span class="params">(<span class="keyword">final</span> View targetView,</span></span></div><div class="line">                                            <span class="keyword">final</span> ColorDrawable color,</div><div class="line">                                            <span class="keyword">int</span>...values) &#123;</div><div class="line">    <span class="keyword">if</span> (targetView == <span class="keyword">null</span>) <span class="keyword">return</span>;</div><div class="line">    <span class="keyword">if</span> (values == <span class="keyword">null</span> || values.length == <span class="number">0</span>) &#123;</div><div class="line">        values = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">0</span>, <span class="number">255</span>&#125;;</div><div class="line">    &#125;</div><div class="line">    ObjectAnimator bgAnim = ObjectAnimator</div><div class="line">            .ofInt(color, <span class="string">"alpha"</span>, values);</div><div class="line">    bgAnim.setDuration(ANIMATION_DURATION);</div><div class="line">    bgAnim.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</div><div class="line">            targetView.setBackgroundDrawable(color);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    bgAnim.start();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在 <code>DetailActivity</code> 中的 <code>tryEnterAnimation()</code>  中给背景加上动画：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">tryEnterAnimation</span><span class="params">()</span> </span>&#123;</div><div class="line">    ZoomAnimationUtils.startZoomUpAnim(mZoomInfo, mImageView, <span class="keyword">null</span>);</div><div class="line">    ZoomAnimationUtils.startBackgroundAlphaAnim(mBackgroundView,</div><div class="line">            <span class="keyword">new</span> ColorDrawable(getResources().getColor(android.R.color.black)), <span class="number">0</span>, <span class="number">255</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="2-退出动画"><a href="#2-退出动画" class="headerlink" title="2.退出动画"></a>2.退出动画</h4><p>重写两个方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBackPressed</span><span class="params">()</span> </span>&#123;</div><div class="line">    tryExitAnimation();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">finish</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.finish();</div><div class="line">  <span class="comment">// 去掉自带的转场动画</span></div><div class="line">    overridePendingTransition(<span class="number">0</span>, <span class="number">0</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>退出动画</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">tryExitAnimation</span><span class="params">()</span> </span>&#123;</div><div class="line">    ZoomAnimationUtils.startBackgroundAlphaAnim(mBackgroundView,</div><div class="line">                                                <span class="keyword">new</span> ColorDrawable(getResources().getColor(android.R.color.black)),</div><div class="line">                                                <span class="number">255</span>,</div><div class="line">                                                <span class="number">0</span>);</div><div class="line">    ZoomAnimationUtils.startZoomDownAnim(mZoomInfo,</div><div class="line">                                         mImageView,</div><div class="line">                                         <span class="keyword">new</span> AnimatorListenerAdapter() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animation)</span> </span>&#123;</div><div class="line">            finish();</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="坑"><a href="#坑" class="headerlink" title="坑"></a>坑</h3><p>我们好像顺利的写完了动画，但是 QA 后来给我提了一个 bug，这个 bug 极其的蛋疼，由这个 bug 又引发了其它的坑，而这些坑基本来自于 <code>Window</code> 的透明。</p>
<ul>
<li>坑一：透明主题的 <code>Activity</code> 如果弹出键盘，并且是 <code>adjustResize</code>  模式，在键盘弹出的一瞬间可以看到前一个 <code>Activity</code> <ul>
<li>原因：键盘弹起时，<code>Activity</code> 重新计算了高度缩短了，而键盘弹起有一个动画，在动画没有执行完毕之前，键盘所占用的空间上没有别的布局只有 <code>Window</code> ，而  <code>Window</code> 是透明的因此就看到了上一个 <code>Activity</code></li>
<li>尝试的解决方案：在动画执行完毕后，将 <code>Window</code> 的背景设置为不透明，但是失败了，见坑二</li>
</ul>
</li>
<li>坑二：如果当前的 <code>Window</code> 背景带有透明度，在动态改变背景的时候会闪一下屏，如果 <code>Window</code> 的初始背景颜色没有透明度，动态改变背景很完美<ul>
<li>原因：不详，目测是 Android 的 bug</li>
<li>解决方案：无。。。</li>
</ul>
</li>
<li>坑三：也是由解决坑二造成的，我试图通过监听键盘弹起事件来手动调节布局，这样 <code>Activity</code> 不需要 resize 也就没有那个 bug，但是发现监听键盘弹起的方法基本都是监听 <code>Activity</code> 重新布局后对比高度来判断的，因此在 <code>adjustNothing</code> 状态下无效，<strong>值得一提的是，跟三弟交流发现他们钻了一个空子，当 <code>Activity</code> 为全屏状态时 <code>adjustResize</code> 是不生效的，但是可以监听到键盘弹出，所以相当于是<code>adjustNothing</code>的效果</strong>，但这种情况没法在我这个项目使用。</li>
</ul>
<p>最后的解决方案：最后为了解决这个 bug ，我用了一个很蠢的方法，在这个透明的 <code>Activity</code> 的前面那个 <code>Activity</code> 上面加上一个前景～（不要跟我说清真。。。逼急了什么都能干得出来）</p>
<h3 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h3><ul>
<li><a href="https://github.com/JoeSteven/ZoomAnimDemo" target="_blank" rel="external">动画Demo</a></li>
<li><a href="https://github.com/qii/weiciyuan" target="_blank" rel="external">微次元</a> — 实现时参考了这个开源项目</li>
<li><a href="https://www.kancloud.cn/qibin0506/android-md/117682" target="_blank" rel="external">你所不知道的Activity转场动画——ActivityOptions</a></li>
<li><a href="http://cashow.github.io/android-get-keyboard-height.html" target="_blank" rel="external">Android - 监听软键盘状态以及获取软键盘的高度</a></li>
</ul>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android/">Android</a>
</div>


</div>



</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/android_long_picture_process/"  title="Android 中的长图片处理">
 <span>Android 中的长图片处理
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="zoom-up-animation/" data-title="Activity 共享元素转场动画实践" data-url="https://joesteven.github.io/zoom-up-animation/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">
<div id="authorInfo">
	
		<div class="author-img"></div>		
	
	<div class="social-info" class="clearfix">
		
		<a href="http://weibo.com/2750146463" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/JoeSteven" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		<a href="http://www.zhihu.com/people/qiao-xi-28" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
		
		<a href="mailto:qiaoxiaoxi621@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		

	</div>
</div>

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Android/" title="Android">Android<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android源码学习/" title="Android源码学习">Android源码学习<sup>11</sup></a></li>
		  
		
		  
			<li><a href="/categories/Tools/" title="Tools">Tools<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/杂谈/" title="杂谈">杂谈<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">链接</p>
    <ul>
        
          <li>
            
            	<a href="http://itscoder.com/" target="_blank" title="itsCoder">itsCoder</a>
            
          </li>
        
          <li>
            
            	<a href="http://imxie.cc/" target="_blank" title="HugoXie">HugoXie</a>
            
          </li>
        
          <li>
            
            	<a href="http://laobie.github.io/" target="_blank" title="写代码的猴子">写代码的猴子</a>
            
          </li>
        
          <li>
            
            	<a href="http://brucezz.github.io/" target="_blank" title="Brucezz">Brucezz</a>
            
          </li>
        
          <li>
            
            	<a href="http://allenwu.itscoder.com/" target="_blank" title="allen">allen</a>
            
          </li>
        
          <li>
            
            	<a href="http://manjusaka.itscoder.com/" target="_blank" title="Manjusaka">Manjusaka</a>
            
          </li>
        
          <li>
            
            	<a href="http://solart.cc/" target="_blank" title="imilk">imilk</a>
            
          </li>
        
          <li>
            
            	<a href="https://yongyu0102.github.io/" target="_blank" title="用语">用语</a>
            
          </li>
        
    </ul>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
		
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/hsihohuang/kiddochan" target="_blank" title="Kiddochan">Kiddochan</a> © 2016 
		
		<a href="/about" target="_blank" title="Joe">Joe</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"extremej"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-81871291-1', 'http://extremej.itscoder.com/');  
ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?a7eee7d6f5059e0cebc1c797881c4f8f";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
